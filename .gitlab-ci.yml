include:
  - project: SocialGouv/gitlab-ci-yml
    file: /autodevops.yml
    ref: v17.0.0-beta.29

variables:
  AUTO_DEVOPS_RELEASE_AUTO: "ðŸ”–"
  AUTO_DEVOPS_PRODUCTION_AUTO: "ðŸš€"
  TEST_DISABLED: 1

Lint:
  rules:
    - when: never

Test:
  rules:
    - when: never

# NOTE(douglasduteil): use custom build job
# The website it statically built with Nextjs
# Here we manually run `yarn next export` and reuse the `out` dir in Dockerfile
Build:
  extends:
    - .autodevops_build
  variables:
    VERSION: ${CI_COMMIT_SHORT_SHA}
  script:
    - yarn next build
    - yarn next export
  artifacts:
    expire_in: 1 day
    paths:
      - out

# NOTE(julienbouquillon): use custom register job
# By default, kosko-charts use a "/app" for default docker images names
# TODO: discuss
Register image:
  extends: .autodevops_register_image
  variables:
    IMAGE_NAME: $CI_REGISTRY_IMAGE/app
